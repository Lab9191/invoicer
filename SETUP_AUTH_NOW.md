# üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ - –°–î–ï–õ–ê–ô–¢–ï –°–ï–ô–ß–ê–°

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

‚úÖ –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
‚úÖ –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞—â–∏—â–µ–Ω—ã
‚úÖ Login –∏ Signup —Ñ–æ—Ä–º—ã —Å–æ–∑–¥–∞–Ω—ã
‚úÖ Middleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å
‚úÖ User menu —Å logout
‚úÖ –í—Å–µ API –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–∞—Å—Ç–æ—è—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## ‚ö†Ô∏è –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨ –í SUPABASE

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Email Authentication

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://supabase.com/dashboard
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Authentication** ‚Üí **Providers**
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ **Email** –≤–∫–ª—é—á–µ–Ω ‚úÖ

### –®–∞–≥ 1.1: –û–¢–ö–õ–Æ–ß–ò–¢–ï Email Confirmation (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

**–í–ê–ñ–ù–û –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Authentication** ‚Üí **Settings**
2. –ù–∞–π–¥–∏—Ç–µ **Enable email confirmations**
3. **–û–¢–ö–õ–Æ–ß–ò–¢–ï** —ç—Ç—É –æ–ø—Ü–∏—é (—É–±–µ—Ä–∏—Ç–µ –≥–∞–ª–æ—á–∫—É) ‚òëÔ∏è ‚Üí ‚¨ú
4. –ù–∞–∂–º–∏—Ç–µ **Save**

–¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–º–æ–≥—É—Ç –≤—Ö–æ–¥–∏—Ç—å **—Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email!

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç–µ RLS Policies (–ö–†–ò–¢–ò–ß–ù–û!)

**–≠—Ç–æ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!**

1. –û—Ç–∫—Ä–æ–π—Ç–µ **SQL Editor** –≤ Supabase
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å —Ñ–∞–π–ª: `supabase/migrations/002_update_rls_for_auth.sql`
3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor
4. –ù–∞–∂–º–∏—Ç–µ **Run**

–≠—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏—è:
- –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ "allow all" –ø–æ–ª–∏—Ç–∏–∫–∏
- –î–æ–±–∞–≤–ª—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ RLS –ø–æ–ª–∏—Ç–∏–∫–∏
- –¢–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ

### –®–∞–≥ 3: ~~–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Email Templates~~ (–ù–ï –ù–£–ñ–ù–û)

Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –ø–æ—ç—Ç–æ–º—É —ç—Ç–æ—Ç —à–∞–≥ –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å.

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Environment Variables

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ Vercel —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

```
NEXT_PUBLIC_SUPABASE_URL=your-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-key
```

## üß™ –ö–∞–∫ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à —Å–∞–π—Ç
2. –ù–∞–∂–º–∏—Ç–µ **Sign Up**
3. –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤)
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ **–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–ª—ã –ø–∞—Ä–æ–ª—è** üí™
   - –ö—Ä–∞—Å–Ω—ã–π = Very Weak
   - –û—Ä–∞–Ω–∂–µ–≤—ã–π = Weak
   - –ñ–µ–ª—Ç—ã–π = Fair
   - –°–∏–Ω–∏–π = Good
   - –ó–µ–ª–µ–Ω—ã–π = Strong ‚úÖ
5. –ù–∞–∂–º–∏—Ç–µ **Create Account**
6. –í–∞—Å **—Å—Ä–∞–∑—É** –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞ (email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ!)

### 2. –í–æ–π–¥–∏—Ç–µ

1. –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å
2. –ù–∞–∂–º–∏—Ç–µ **Sign In**
3. –í–∞—Å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
4. –¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å Company –∏–ª–∏ Individual
5. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å, –∫–ª–∏–µ–Ω—Ç–æ–≤, –∏–Ω–≤–æ–π—Å—ã

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞—â–∏—Ç—É

1. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤–æ–µ –æ–∫–Ω–æ –±—Ä–∞—É–∑–µ—Ä–∞ –≤ —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å `/en/company/invoices`
3. –î–æ–ª–∂–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ `/en/auth/login` ‚úÖ
4. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç –∑–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Auto-Logout

1. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É
2. –û—Å—Ç–∞–≤—å—Ç–µ –±—Ä–∞—É–∑–µ—Ä –æ—Ç–∫—Ä—ã—Ç—ã–º, –Ω–æ **–Ω–µ —Ç—Ä–æ–≥–∞–π—Ç–µ –Ω–∏—á–µ–≥–æ** 10 –º–∏–Ω—É—Ç
3. –ü–æ—Å–ª–µ 10 –º–∏–Ω—É—Ç –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è –≤–∞—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∫–∏–Ω–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞ ‚è±Ô∏è
4. –õ—é–±–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (–∫–ª–∏–∫, —Å–∫—Ä–æ–ª–ª, –ø–µ—Ä–µ—Ö–æ–¥) **–ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç —Å–µ—Å—Å–∏—é** –Ω–∞ 10 –º–∏–Ω—É—Ç

### 5. –í—ã–π–¥–∏—Ç–µ –≤—Ä—É—á–Ω—É—é

1. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –≤–∞—à email –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
2. –ù–∞–∂–º–∏—Ç–µ **Logout**
3. –í–∞—Å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞
4. –¢–µ–ø–µ—Ä—å —Å–Ω–æ–≤–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–æ–π—Ç–∏ —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–¢–µ–ø–µ—Ä—å –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ **–ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–©–ò–©–ï–ù–û**:

- ‚úÖ –ù–∏–∫—Ç–æ –Ω–µ –º–æ–∂–µ—Ç —É–≤–∏–¥–µ—Ç—å –¥–∞–Ω–Ω—ã–µ –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –î–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ Postgres
- ‚úÖ Sessions –±–µ–∑–æ–ø–∞—Å–Ω—ã (HTTP-only cookies)
- ‚úÖ **Password strength indicator** –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ üí™
- ‚úÖ **Auto-logout —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç** –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ ‚è±Ô∏è
- ‚úÖ **Auto-refresh —Å–µ—Å—Å–∏–∏** –ø—Ä–∏ –ª—é–±–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –±–µ–∑ email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

## üìß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Email –¥–ª—è Production

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Supabase –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Ö email —Å–µ—Ä–≤–∏—Å (–º–µ–¥–ª–µ–Ω–Ω—ã–π).

–î–ª—è production –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ SMTP:

1. **Settings** ‚Üí **Auth** ‚Üí **SMTP Settings**
2. –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à SMTP provider:
   - SendGrid (–±–µ—Å–ø–ª–∞—Ç–Ω–æ 100 –ø–∏—Å–µ–º/–¥–µ–Ω—å)
   - AWS SES (–æ—á–µ–Ω—å –¥–µ—à–µ–≤–æ)
   - Mailgun
   - Gmail (–¥–ª—è —Ç–µ—Å—Ç–æ–≤)

## ‚ùì Troubleshooting

### "Email –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç" ‚Üí **–†–ï–®–ï–ù–û!**

Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –≤—Ö–æ–¥–∏—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.

### "–ù–µ –º–æ–≥—É –≤–æ–π—Ç–∏"

- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ –≤ Supabase (Authentication ‚Üí Settings)
- –ü–∞—Ä–æ–ª—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ç–æ—Ç –∂–µ email –∏ –ø–∞—Ä–æ–ª—å

### "403 –∏–ª–∏ RLS error"

- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∑–∞–ø—É—Å—Ç–∏–ª–∏ migration 002_update_rls_for_auth.sql
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ user_id –≤ —Ç–∞–±–ª–∏—Ü–µ profiles —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å auth.uid()

## üéØ –ß—Ç–æ –î–∞–ª—å—à–µ?

–í—Å–µ –≥–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ:

1. ‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. ‚úÖ –°–æ–∑–¥–∞—Ç—å company profile
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤
4. ‚úÖ –°–æ–∑–¥–∞—Ç—å –∏–Ω–≤–æ–π—Å—ã
5. ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ PDF

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞—â–∏—â–µ–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

## üÜò –ù—É–∂–Ω–∞ –ü–æ–º–æ—â—å?

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ —Ñ–∞–π–ª–µ: **AUTHENTICATION_SETUP.md**
